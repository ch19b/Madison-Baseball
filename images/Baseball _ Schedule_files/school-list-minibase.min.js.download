// MINIBASE SCHOOL LIST MANAGEMENT
// AUTHOR: BRENTON KELLY - CREATIVE DEVELOPMENT MANAGER - BLACKBOARD, INC.
// VERSION: 06.06.18

!function(d){d.schoolListMinibase=function(e){var o={miniBaseDomainID:0,miniBaseModuleInstanceID:0,minibaseFields:["schoolName","schoolType","schoolUrl","schoolAlias","schoolVisible"],cache:!0,schoolListReady:function(e){}};if(e&&d.extend(o,e),-1<window.location.href.indexOf("PageType=12")&&-1<window.location.href.indexOf("DomainId="+o.miniBaseDomainID)&&-1<window.location.href.indexOf("ModuleinstanceId="+o.miniBaseModuleInstanceID)&&(n("CreativeRedirectTo")?window.location.replace(n("CreativeRedirectTo")):(c("CreativeRedirectTo","/domain/"+o.miniBaseDomainID),window.location.replace("/domain/"+o.miniBaseDomainID))),1==o.cache&&"undefined"!=typeof Storage&&sessionStorage.getItem("cs-school-list-data"))o.schoolListReady.call(this,JSON.parse(sessionStorage.getItem("cs-school-list-data"))),r();else if(d("#swlogin").length&&-1<location.protocol.indexOf("https")){var t=location.protocol+"//"+window.location.hostname;d.ajax({type:"POST",url:t+"/GlobalAssets/Proxies/ServiceProxy.aspx/CallService",data:"{BaseURL: '"+t+"/site/default.aspx', InvokeMethod: 'GET', ServiceMethod: '', ServiceParameters: '?PageType=12&DomainId="+o.miniBaseDomainID+"&ModuleinstanceId="+o.miniBaseModuleInstanceID+"', ConnectionType: '', RequestBody: ''}",async:!0,contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,success:function(e){var t=JSON.parse(e.d).data.replace(/\n|\r/g,""),i=t.indexOf('<div id="module-content-'+o.miniBaseModuleInstanceID),n=t.indexOf("\x3c!-- End Centricity Content Area --\x3e")-6,s=t.substring(i,n);d("#swlogin").append('<div id="school-list-minibase" style="display: none;">'+s+"</div>");var a=l("#school-list-minibase");o.schoolListReady.call(this,a),r(),-1===window.location.href.indexOf("PageType=8")&&-1===window.location.href.indexOf("PageType=7")&&c("CreativeRedirectTo",window.location.href)}})}else d.ajax({type:"GET",url:"/site/default.aspx?PageType=12&DomainId="+o.miniBaseDomainID+"&ModuleinstanceId="+o.miniBaseModuleInstanceID,cache:!1,success:function(e){var t=l(e);(function(){try{return sessionStorage.setItem("test","1"),sessionStorage.removeItem("test"),!0}catch(e){return!1}})()&&1==o.cache&&sessionStorage.setItem("cs-school-list-data",JSON.stringify(t)),o.schoolListReady.call(this,t),r(),-1===window.location.href.indexOf("PageType=8")&&-1===window.location.href.indexOf("PageType=7")&&c("CreativeRedirectTo",decodeURIComponent(window.location.href))}});function l(e){var n=[],t=d(e).find("#module-content-"+o.miniBaseModuleInstanceID+" .sw-flex-table").length?"table":"list";return"table"==t?d(e).find("#module-content-"+o.miniBaseModuleInstanceID+" .sw-flex-table tr:not(.sw-flex-column-heading)").each(function(){var t={};d("> td",this).each(function(e){void 0!==o.minibaseFields[e]&&(t[o.minibaseFields[e]]=d.trim(d(this).text()))}),n.push(t)}):"list"==t&&d(e).find("#module-content-"+o.miniBaseModuleInstanceID+" .sw-flex-list .sw-flex-item-group").each(function(){var e={};d("> .sw-flex-item-list > .sw-flex-item",this).each(function(){d("> .sw-flex-item-label",this).remove(),void 0!==o.minibaseFields[i]&&(e[o.minibaseFields[i]]=d.trim(d(this).text()))}),n.push(e)}),n}function r(){d(".sw-mystart-dropdown.schoollist .sw-dropdown-list li a").keydown(function(e){if(e.stopPropagation(),38==e.keyCode)e.preventDefault(),0==d(this).parent("li").prev("li").length?0<d(this).parents("ul").parents(".sw-mystart-nav").length?d(this).parents("ul").parents(".sw-mystart-nav").focus():d(this).parents("ul").prev(".sw-mystart-nav").focus():d(this).parent("li").prev("li").find("a").first().focus();else if(40==e.keyCode)e.preventDefault(),0==d(this).parent("li").next("li").length?0<d(this).parents("ul").parents(".sw-mystart-nav").length?d(this).parents("ul").parents(".sw-mystart-nav").focus():d(this).parents("ul").prev(".sw-mystart-nav").focus():(d(this).parent("li").next("li").find("a").first().attr("tabIndex",0),d(this).parent("li").next("li").find("a").first().focus());else if(27==e.keyCode||37==e.keyCode)e.preventDefault(),hideMyStartBarMenu();else if(32==e.keyCode)e.preventDefault(),window.location=d(this).attr("href");else{var t=!1;d(this).parent("div").nextAll("li").find("a").each(function(){if(d(this).text().substring(0,1).toLowerCase()==keyCodeMap[e.keyCode])return d(this).focus(),!(t=!0)}),t||d(this).parent("div").prevAll("li").find("a").each(function(){if(d(this).text().substring(0,1).toLowerCase()==keyCodeMap[e.keyCode])return d(this).focus(),!1})}})}function c(e,t,i){var n;if(i){var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3),n="; expires="+s.toGMTString()}else n="";document.cookie=escape(e)+"="+escape(t)+n+"; path=/"}function n(e){for(var t=escape(e)+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var s=i[n];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return unescape(s.substring(t.length,s.length))}return null}}}(jQuery);